\chapter{Koncepcja projektu}
\label{chap:2}
Na pocz¹tku rozdzia³u przedstawiono pod³o¿e teoretyczne pracy. Nastêpnie dokonano porównania miêdzy koncepcj¹ pierwotn¹, a finaln¹ architektury systemu. W kolejnych podrozdzia³ach zawarto uzasadnienie decyzji projektowych finalnej struktury systemu oraz wyjaœniono podstawy technologii wybranych do realizacji poszczególnych zadañ. Praktyczne implementacje znajduj¹ siê w treœci rozdzia³u~\ref{chap:3}

\section{Pod³o¿e teoretyczne}
W poni¿szym podrozdziale przedstawiono pod³o¿e teoretyczne trzech zagadnieñ: komputer rowerowy, GPS oraz GPX. Koncepcje te stoj¹ u podstaw ca³ej pracy. Z tego te¿ wzglêdu, zaznajomienie siê z poni¿szymi informacjami jest wskazane przed przyst¹pieniem do lektury dalszych rozdzia³ów.

\subsection{Komputer rowerowy}
Elektroniczny komputer rowerowy, potocznie zwany równie¿ licznikiem rowerowym, to w ogólnym ujêciu urz¹dzenie przeznaczone do rejestrowania oraz prezentowania statystyk podró¿y rowerowej. W swojej idei przypomina samochodow¹ tablicê rozdzielcz¹. Pocz¹tkowo tego typu urz¹dzenia mia³y doœæ ograniczone mo¿liwoœci, które g³ównie sprowadza³y siê do obliczania i wyœwietlania: prêdkoœci z~jak¹ w danej chwili przemieszcza siê rower, przejechanego ca³kowitego dystansu czy obecnej godziny. Z biegiem czasu liczniki by³y wzbogacane w nowe funkcje, jak np.:~obliczanie prêdkoœci œredniej, obliczanie czasu podró¿y, wskazanie kadencji, odczyt temperatury powietrza,~itp.
Zasada dzia³ania prostego licznika rowerowego oparta jest na trzech g³ównych elementach:
\begin{enumerate}
    \item Magnes zamontowany na szprysze ko³a roweru.
    \item Czujnik reaguj¹cy na magnes, zamontowany na ramie roweru tak, aby przy obrocie ko³a magnes przemieszcza³ siê w odleg³oœci ok. 1cm od czujnika.
    \item Urz¹dzenie elektroniczne z wyœwietlaczem zamontowane najczêœciej na kierownicy.
\end{enumerate}

Prêdkoœæ z jak¹ porusza siê rower obliczana jest przez urz¹dzenie na podstawie liczby obrotów ko³a zarejestrowanych przez czujnik w okreœlonej jednostce czasu oraz zadanej œrednicy ko³a. Inne dane pobierane s¹ z dodatkowych czujników np.:~temperatura --- wbudowany elektroniczny termometr, kadencja --- czujnik magnetyczny z magnesem zamontowanym do peda³ów,~itp.

Za prze³om w dziedzinie komputerów rowerowych mo¿na uznaæ wyposa¿enie licznika w wydajny mikroprocesor, wiêkszy wyœwietlacz oraz modu³ GPS (ang.~\emph{Global Positioning System}). Znacz¹co rozszerzy³o to listê dostêpnych funkcji. Informacja o pozycji urz¹dzenia pozwoli³a na wykorzystanie map cyfrowych, na których w czasie rzeczywistym wyœwietlana jest obecna pozycja. W zwi¹zku z tym pojawi³a siê równie¿ mo¿liwoœæ uprzedniego wytyczania tras, a nastêpnie nawigowania rowerzysty w trakcie podró¿y. Ponadto na podstawie samych danych lokalizacyjnych mo¿na w prosty sposób, na bie¿¹co wyliczaæ szereg statystyk, jak np.:~prêdkoœæ, przejechany dystans, po³o¿enie geograficzne (szerokoœæ geograficzna, d³ugoœæ geograficzna, wysokoœæ nad poziomem morza), bez koniecznoœci stosowania dodatkowych czujników. Wszystkie te dane mog¹ zostaæ zapisane w celu archiwizacji oraz póŸniejszej analizy.

Pocz¹tkowo, aby korzystaæ z funkcji komputera rowerowego, konieczne by³o zaopatrzenie siê w dedykowane urz¹dzenie, jednak obecnie równie dobr¹ alternatyw¹ jest u¿ycie smartfona z~zainstalowan¹ odpowiedni¹ aplikacj¹. Jest to rozwi¹zanie bardziej przystêpne dla przeciêtnego u¿ytkownika z dwóch g³ównych przyczyn:
\begin{enumerate}
    \item Wspó³czeœnie znakomita wiêkszoœæ osób jest posiadaczem smartfona.
    \item Nie wymaga inwestycji finansowej.
\end{enumerate}

Aplikacji tego typu dostêpnych na rynku jest wiele. Do najpopularniejszych nale¿¹ m.in.:~\texttt{Strava}, \texttt{Cyclemeter}, \texttt{MapMyRide}, \texttt{Bikemap}, \texttt{Komoot}, czy \texttt{Wahoo~Fitness}. Mimo ¿e wszystkie udostêpniaj¹ fundamentalne funkcjonalnoœci komputera rowerowego, to ró¿ni¹ siê one w zakresie funkcjonalnoœci dodatkowych. Czêœæ z nich skierowana jest bardziej w stronê organizacji treningów (np.~\texttt{Strava}), inne specjalizuj¹ siê w planowaniu tras (np.~\texttt{Komoot}), a jeszcze inne skoncentrowane s¹ na analizie statystyk (np.~\texttt{Cyclemeter}).

Zarówno dedykowane urz¹dzenia, jak i aplikacje na smartfony do eksportu oraz importu danych pos³uguj¹ siê zazwyczaj standardem GPX. Dziêki temu u¿ytkownicy w razie w³asnych upodobañ oraz potrzeb mog¹ w doœæ ³atwy sposób migrowaæ miêdzy poszczególnymi us³ugami.

\subsection{GPS}
Zarówno dedykowane komputery rowerowe, jak i smartfony z zainstalowanymi aplikacjami wykorzystuj¹ system GPS. GPS (ang. \emph{Global Positioning System}) jest to system nawigacji satelitarnej opracowany w latach 70. XX w. przez Departament Obrony Stanów Zjednoczonych, który swoim zasiêgiem obejmuje ca³¹ kulê ziemsk¹. Zadaniem GPSa jest dostarczanie do odbiornika informacji o jego obecnym po³o¿eniu. Na system sk³adaj¹ siê trzy g³ówne, œciœle wspó³pracuj¹ce ze sob¹ segmenty~\cite{gps}:
\begin{enumerate}
    \item Segment naziemny --- naziemne stacje nadawcze.
    \item Segment kosmiczny --- satelity na orbicie Ziemi.
    \item Segment u¿ytkownika --- odbiorniki na powierzchni Ziemi lub w stosunkowo niewielkiej odleg³oœci niej.
\end{enumerate}

Stacje nadawacze na Ziemi rozmieszczone s¹ w taki sposób, aby ka¿dy satelita jest zawsze w zasiêgu minimum dwóch nadajników. Zadaniem stacji jest przesy³anie do satelitów sygna³ów korekcyjnych czasu i~pozycji.

Satelity rozmieszczone s¹ w taki sposób, aby w ka¿dym punkcie na Ziemi dostêpny by³ sygna³ z co najmniej czterech z nich. Na dzieñ 2 listopada 2021 roku w sk³ad konstelacji wchodzi 30 operacyjnych satelitów~\cite{gpsconstellation}. Ich zadaniem jest nadawanie sygna³u radiowego, który zawiera informacje o obecnym wzajemnym po³o¿eniu satelitów, o teoretycznej trajektorii lotu oraz odchyleñ od niej.

Odbiornik na powierzchni ziemi na podstawie odebranych sygna³ów z minimum czterech satelitów okreœla odleg³oœæ od nich, a nastêpnie wylicza swoj¹ pozycjê geograficzn¹ --- standardowo w uk³adzie odniesienia WGS-84 (ang.~\emph{World Geodetic System '84}). Czynniki, które mog¹ zak³óciæ sygna³, a co za tym idzie wp³yn¹æ na jakoœæ okreœlenia pozycji, to m.in.:
\begin{itemize}
    \item opóŸnienia propagacji sygna³u spowodowane przez atmosferê ziemsk¹;
    \item odbicia sygna³u od obiektów na Ziemi (np.~wysokie budynki w mieœcie);
    \item ma³a liczba dostêpnych w zasiêgu satelitów (im wiêcej, tym lepiej);
    \item wzajemne po³o¿enie satelitów (im ,,szerzej'' s¹ rozstawione satelity, tym lepiej);
    \item odchylenie po³o¿enia satelitów od wyznaczonej trajektorii lotu;
    \item b³êdy zegara (niedok³adne wskazanie czasu).
\end{itemize}

Pierwotnie system GPS utworzony zosta³ z myœl¹ o zastosowaniach militarnych, jednak ostatecznie zosta³ udostêpniony równie¿ dla cywilów oraz do zastosowañ komercyjnych. Ponadto nale¿y zaznaczyæ, ¿e równolegle do systemu GPS funkcjonuj¹ analogiczne systemy nawigacji satelitarnej, jak np.:~rosyjski GLONASS~\cite{glonass}, europejski Galileo~\cite{galileo}, czy chiñski BeiDou~\cite{beidou}.


\subsection{GPX}
GPX (ang.~\emph{GPS Exchange Format})~\cite{gpxpage} to otwarty, ustandaryzowany schemat jêzyka XML (ang.~\emph{Extensible Markup Language}) opracowany w celu ujednolicenia procesu transferu danych pomiêdzy urz¹dzeniami, aplikacjami i us³ugami wykorzystuj¹cymi system GPS. Obecna wersja standardu to wydany 9 sierpnia 2004 GPX 1.1.

Dziêki wykorzystaniu architektury XML poszczególne dane lokalizacyjne uzyskane z systemu GPS zapisywane s¹ w koresponduj¹cych tagach XML, a te z kolei stanowi¹ zawartoœæ plików, których domyœlnym rozszerzeniem jest \texttt{*.gpx}. Pliki te mo¿na w prosty sposób eksportowaæ, przenosiæ, udostêpniaæ i importowaæ pomiêdzy ró¿nymi urz¹dzeniami. Standard zapewnia, ¿e dane zawsze bêd¹ poprawne i jednakowo interpretowane na dowolnej platformie.

W standardzie zdefiniowane zosta³y nastêpuj¹ce typy danych:
\begin{itemize}
    \item gpxType;
    \item typy proste: \texttt{latitudeType}, \texttt{longitudeType}, \texttt{degreesType},  \texttt{dgpsStationType}, \texttt{fixType};
    \item typy z³o¿one: \texttt{metadataType}, \texttt{wptType}, \texttt{rteType}, \texttt{trkType}, \texttt{extensionsType}, \texttt{trksegType}, \texttt{copyrightType}, \texttt{linkType}, \texttt{emailType}, \texttt{personType}, \texttt{ptType},\texttt{ptsegType}, \texttt{boundsType}.
\end{itemize}
Spoœród powy¿szej listy, na szczególne omówienie zas³uguj¹ trzy typy z³o¿one: \texttt{wptType} --- \emph{waypoint type}, \texttt{rteType} --- \emph{route type} oraz \texttt{trkType} --- \emph{track type}:
\begin{enumerate}
    \item \emph{Waypoint type} to pojedynczy punkt nale¿¹cy do kolekcji punktów, ale nieskorelowany z pozosta³ymi punktami tej kolekcji. Punkt taki zawiera w sobie dane o lokalizacji, tj.: szerokoœæ (\texttt{latitudeType}) i d³ugoœæ (\texttt{longitudeType}) geograficzn¹ oraz mo¿e zawieraæ dodatkowe informacje, jak np.:~wysokoœæ nad poziomem morza (elevation), czas, komentarz tekstowy i inne.
    \item \emph{Route type}, co mo¿na przet³umaczyæ jako trasa lub droga. Jest to uporz¹dkowana lista punktów, które prowadz¹ do okreœlonego celu.
    \item \emph{Track type}, czyli œcie¿ka, droga lub œlad, to lista zawieraj¹ca co najmniej jeden segment (pewien fragment œcie¿ki), który z kolei zawiera listê punktów. Punkty te odzwierciedlaj¹ realn¹ œcie¿kê, któr¹ przeby³ odbiornik GPS.
\end{enumerate}

Kluczowe jest rozró¿nienie miêdzy \emph{route type} i \emph{track type}, pierwszy z nich wytycza jedynie punkty poœrednie prowadz¹ce do celu, drugi z nich to zapis rzeczywistych danych zebranych przez fizyczne urz¹dzenie. Poniewa¿ polskie t³umaczenia tych angielskich terminów mog¹ nie byæ w pe³ni jednoznaczne, autor pracy sugeruje, aby w kontekœcie standardu GPX pos³ugiwaæ siê angielskimi formami. W zwi¹zku z tym, aby unikn¹æ nieporozumieñ, w dalszej treœci pracy terminy te zapisano w oryginalnej formie angielskiej (ewentualnie skróconej do \emph{route}  i \emph{track}).

Szablonow¹ strukturê standardu GPX~\cite{gpxschema} przedstawiono na listingu~\ref{lst:gpxschema} natomiast na listingu~\ref{lst:gpxexample} pokazano zawartoœæ przyk³adowego pliku (fragment rzeczywistych danych zebranych przez autora pracy, wyeksportowanych z aplikacji mobilnej \texttt{Komoot}). Z listingu mo¿na odczytaæ, ¿e plik zawiera jeden \emph{track}, która sk³ada siê z jednego segmentu (trkseg) z list¹ punktów (trkpt). Lista ta na potrzeby demonstracji zosta³a skrócona do trzech punktów, jednak w rzeczywistoœci, w zale¿noœci od d³ugoœci \emph{tracka}, mo¿e ona liczyæ setki, a nawet tysi¹ce punktów.

{\belowcaptionskip=-9pt
\begin{lstlisting}[language=XML, label=lst:gpxschema, caption=Struktura pliku GPX,
    basicstyle=\footnotesize\ttfamily]
<gpx
 version="1.1 [1] ?"
 creator="xsd:string [1] ?">
    <metadata> metadataType </metadata> [0..1] ?
    <wpt> wptType </wpt> [0..*] ?
    <rte> rteType </rte> [0..*] ?
    <trk> trkType </trk> [0..*] ?
    <extensions> extensionsType </extensions> [0..1] ?
</gpx>
\end{lstlisting}
}

{\belowcaptionskip=-9pt
\begin{lstlisting}[language=XML, label=lst:gpxexample, caption=Przyk³adowy plik GPX,
    basicstyle=\footnotesize\ttfamily]
<?xml version='1.0' encoding='UTF-8'?>
<gpx version="1.1" creator="https://www.komoot.de" xmlns="http://www.topografix.com/GPX/1/1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">
    <metadata>
    <name>This is the track name</name>
    <author>
        <link href="https://www.komoot.de">
        <text>komoot</text>
        <type>text/html</type>
        </link>
    </author>
    </metadata>
    <trk>
        <name>This is the track name</name>
        <trkseg>
            <trkpt lat="51.191923" lon="17.014499">
                <ele>156.033586</ele>
                <time>2021-10-29T17:11:11.876Z</time>
            </trkpt>
            <trkpt lat="51.192004" lon="17.014368">
                <ele>156.155631</ele>
                <time>2021-10-29T17:11:13.870Z</time>
            </trkpt>
            <trkpt lat="51.192077" lon="17.014230">
                <ele>156.275396</ele>
                <time>2021-10-29T17:11:15.873Z</time>
            </trkpt>
            [...]
        </trkseg>
    </trk>
</gpx>
\end{lstlisting}
}

Dziêki otwartoœci standardu mo¿liwe jest jego rozszerzanie. Jednym z popularnych rozszerzeñ jest \emph{Garmin GPX Schema Extension}. Dodaje ono nowe typy danych, które pozwalaj¹ zapisaæ w pliku dodatkowe informacje. Przyk³adowo, w omówionym wczeœniej \emph{waypoint type} mo¿na utrwaliæ zarejestrowan¹ w danym punkcie temperaturê lub kategoriê do której dany punkt nale¿y. Z kolei \emph{track type} zyskuje mo¿liwoœæ przechowywania koloru, w jakim œlad powinien zostaæ wyœwietlony na mapie. Pe³ny zakres rozszerzenia opisany jest w oficjalnym schemacie \cite{gpxgarmin}.

\section{Wymagania funkcjonalne}

W wyniku zebrania wymagañ projektowych powsta³a lista funkcjonalnoœci u¿ytkowych, któr¹ podzielono na trzy kategorie: podstawowe, dodatkowe oraz dalszego rozwoju. Zaimplementowanie wszystkich funkcjonalnoœci z kategorii podstawowych bêdzie równoznaczne z osi¹gniêciem wyznaczonego celu pracy. W przypadku efektywnego tempa rozwoju oprogramowania oraz zapasu czasu, powinno dojœæ do wdro¿enia funkcjonalnoœci z kategorii dodatkowych. Ostatnia kategoria nie jest przewidziana do realizacji w ramach niniejszej pracy. Przedstawia ona jedynie pomys³y i kierunek dalszego rozwoju. Kompletna lista jest nastêpuj¹ca:
\begin{enumerate}
    \item Funkcjonalnoœci podstawowe
          \begin{itemize}
              \item Uwierzytelnianie u¿ytkownika
              \item Nagrywanie œladów GPS (standard GPX)
              \item Import œladów GPS (pliki \texttt{*.gpx})
              \item Eksport œladów GPS (pliki \texttt{*.gpx})
              \item Statystki œladu GPS (liczby, wykresy, prezentacja na mapie)
              \item Statystki ogólne u¿ytkownika (liczby, wykresy)
          \end{itemize}
    \item Funkcjonalnoœci dodatkowe
          \begin{itemize}
              \item Edycja profilu (np.:~zmiana adresu email, zdjêcia profilowego, has³a, innych danych personalnych)
              \item Mapa cieplna aktywnoœci (ang. \emph{Heat Map})
              \item Podstawowe elementy mediów spo³ecznoœciowych (przegl¹danie profili u¿ytkowników, udostêpnianie aktywnoœci)
          \end{itemize}
    \item Dalszy rozwój
          \begin{itemize}
              \item Planowanie dróg z wykorzystaniem mapy
              \item Nawigacja wed³ug zaplanowanych dróg
              \item Rozbudowane funkcjonalnoœci mediów spo³ecznoœciowych (system znajomych, komentarze, wydarzenia grupowe, wspó³dzielone planowanie tras, wspó³dzielona nawigacja)
          \end{itemize}
\end{enumerate}

\section{Architektura systemu}
Pierwotna koncepcja zak³ada³a zaprojektowanie i implementacjê dwóch osobnych aplikacji pod wspóln¹ nazw¹. Pierwsz¹ z nich mia³a byæ aplikacja internetowa (dostêp poprzez przegl¹darkê). W niej zawarte mia³y byæ wszystkie planowane funkcjonalnoœci za wyj¹tkiem jedynie nagrywania œladów z wykorzystaniem modu³u GPS. Za to zadanie mia³a byæ odpowiedzialna dedykowana aplikacja mobilna dla systemu \texttt{Android}. Ta wizja jednak uleg³a zmianie --- finalna wersja zak³ada wykonanie aplikacji internetowej w technice PWA. Pozwala ona na instalacjê aplikacji internetowej na urz¹dzeniu mobilnym i sprawienie wra¿enia aplikacji natywnej. Takie rozwi¹zanie posiada zarówno swoje zalety, jak i wady. Do korzyœci na pewno nale¿¹:
\begin{enumerate}
    \item Jedna aplikacja oznacza jedn¹ bazê kodu, któr¹ ³atwiej jest utrzymaæ i rozwijaæ w stosunku do dwóch osobnych baz.
    \item Funkcjonalnoœci aplikacji mobilnej i internetowej s¹ identyczne.
    \item Aplikacja mobilna nie jest ograniczona do dzia³ania jedynie na systemie \texttt{Android}.
    \item Brak koniecznoœci rozprowadzania pakietu instalacyjnego aplikacji mobilnej.
\end{enumerate}
G³ównym problemem natomiast mo¿e okazaæ siê wydajnoœæ takiego rozwi¹zania. Dzia³anie PWA oparte jest na przegl¹darce internetowej. Z kolei aplikacje natywne dzia³aj¹ w systemie jako niezale¿ne instancje. W ogólnym ujêciu aplikacje natywne pozwalaj¹ na uzyskanie lepszej wydajnoœci, poniewa¿ maj¹ bezpoœredni dostêp do zasobów sprzêtowych.

Porównanie koncepcji oraz dobór technologii realizacji poszczególnych modu³ów systemu zestawiono w tabeli~\ref{tab:koncepcje}. Wyjaœnienie oraz uzasadnienie tych wyborów zawarto w kolejnych podrozdzia³ach.

\begin{table}[htb] \small
    \centering
    \caption{Porównanie koncepcji architektury systemu i dobór technologii}
    \label{tab:koncepcje}
    \begin{tabularx}{\linewidth}{|l|l|X|} \hline
        Zadanie               & Koncept pierwotny                                          & Koncept finalny            \\ \hline\hline
        Aplikacja internetowa & \texttt{React}                                             & \texttt{React (PWA)}       \\ \hline
        Aplikacja mobilna     & \texttt{React Native}                                      & \texttt{React (PWA)}       \\ \hline
        Backend               & \texttt{Firebase}                                          & \texttt{Firebase}          \\ \hline
        Baza danych           & \texttt{Firebase Firestore} lub \texttt{Realtime Database} & \texttt{Realtime Database} \\ \hline
        Hosting               & \texttt{Firebase Hosting}                                  & \texttt{Firebase Hosting}  \\ \hline
    \end{tabularx}
\end{table}

\section{Warstwa backend}
W tradycyjnym podejœciu tworzenia aplikacji internetowej lub mobilnej, poza wykonaniem oprogramowania klienckiego, zazwyczaj konieczne jest utworzenie serwera, bazy danych, magazynu plików, systemu uwierzytelniania oraz po³¹czenie tych (i wielu innych) elementów w dzia³aj¹c¹ ca³oœæ.

Alternatyw¹ jest wykorzystanie modelu BaaS (ang.~\emph{Backend-as-a-Service}), który przenosi odpowiedzialnoœæ za funkcje backendowe na dostawcê BaaS. Poszczególne modu³y (np.:~baza danych czy system uwierzytelniania) do³¹czane s¹ do warstwy klienta z u¿yciem pakietów SDK (ang.~\emph{Software Development Kit}) oraz API (ang.~\emph{Application Programming Interface}). Obrazowo mo¿na przedstawiæ to tak: programista buduje system z gotowych, dostarczonych z zewn¹trz, konfigurowalnych klocków, zamiast tworzyæ swoje w³asne klocki od podstaw. Dziêki temu rozwój oprogramowania jest szybszy, tañszy, oraz mniej podatny na b³êdy, a samo oprogramowanie jest ³atwo skalowalne. Jednak w przypadku zapotrzebowania na unikalne funkcjonalnoœci warstwy backend, BaaS mo¿e siê nie sprawdziæ ze wzglêdu na ograniczone mo¿liwoœci~konfiguracyjne.

BaaS jest technologi¹ stosunkowo now¹, poniewa¿ pierwsze projekty w tej dziedzinie siêgaj¹ zaledwie pocz¹tku drugiej dekady XX wieku. Obecnie na rynku dostêpnych jest wiele platform. Do najpopularniejszych mo¿na zaliczyæ (kolejnoœæ losowa): \texttt{Google Firebase}, \texttt{Apple CloudKit}, \texttt{Amazon AWS Amplify}, \texttt{Microsoft Azure Mobile Apps}, \texttt{Back4App}, \texttt{Parse} czy \texttt{Backendless}. Czêœæ z nich jest jest oprogramowaniem otwartym. Platformy komercyjne udostêpniaj¹ swoje us³ugi w chmurze, w ramach darmowych oraz p³atnych planów (np.:~\texttt{Firebase}, \texttt{AWS Amplify}). Niektóre platformy wymagaj¹ w³asnego hostowania (np.:~\texttt{Parse}).

Ca³a warstwa backend realizowanego projektu oparta jest na platformie \texttt{Google Firebase}. W jej zakres wchodz¹ modu³y, które przedstawiono w tabeli~\ref{tab:firebase}. Szczegó³y mo¿na znaleŸæ w dokumentacji technicznej \cite{firebase}. G³ówne powody wybrania akurat tej platformy s¹ nastêpuj¹ce:
\begin{itemize}
    \item Podstawowe doœwiadczenie autora w integracji z platform¹, wynikaj¹ce z wykorzystania jej we wczeœniej realizowanych projektach.
    \item Dostêpnoœæ platformy w chmurze (brak koniecznoœci samodzielnego hostowania backendu).
    \item Dostêpnoœæ darmowego planu, pokrywaj¹cego zapotrzebowanie w ramach rozwoju i testowania tworzonego oprogramowania.
    \item Pokrycie wszystkich wymagañ projektu przez udostêpniane przez platformê us³ugi.
\end{itemize}

\begin{table}[htb] \small
    \centering
    \caption{Lista bibliotek wykorzystanych przy implementacji aplikacji klienta}
    \label{tab:firebase}
    \begin{tabularx}{\linewidth}{|l|X|} \hline
        Modu³                       & Opis                                                                                                                                                                                              \\ \hline\hline
        \texttt{Authentication}     & System uwierzytelniania (email i has³o, \emph{identity provider}, numer telefonu, \emph{custom}, sesja anonimowa). \texttt{FirebaseUI} --- gotowe rozwi¹zanie uwierzytelniania w warstwie klienta \\ \hline
        \texttt{Realtime Database}  & Baza danych NoSQL (baza JSON)                                                                                                                                                                     \\ \hline
        \texttt{Firestore Database} & Baza danych NoSQL (baza dokumentowa)                                                                                                                                                              \\ \hline
        \texttt{Cloud Storage}      & Przestrzeñ do przechowywania plików                                                                                                                                                               \\ \hline
        \texttt{Machine Learning}   & Dostêp do wyuczonych modeli oraz mo¿liwoœæ szkolenia w³asnych modeli w chmurze lub na urz¹dzeniu u¿ytkownika                                                                                      \\ \hline
        \texttt{Hosting}            & Hosting aplikacji internetowych, statycznej i dynamicznej zawartoœci oraz mikroserwisów w sieci                                                                                                   \\ \hline
        \texttt{Cloud Functions}    & Framework umo¿liwiaj¹cy wykonanie zadanego kodu po stronie backendu w odpowiedzi na zdarzenie lub zapytanie HTTPS.                                                                                \\ \hline
    \end{tabularx}
\end{table}

W ramach projektu wykorzystane zosta³y modu³y: \texttt{Authentication}, \texttt{Realtime Database} i \texttt{Hosting}. W kolejnych podrozdzia³ach opisano  zwi¹zane z nimi za³o¿enia.

\subsection{Uwierzytelnianie}
Implementacja w³asnego systemu uwierzytelniana jest procesem z³o¿onym, pracoch³onnym i wymagaj¹cym odpowiedniej wiedzy. Dlatego Firebase dostarcza modu³ Authentication odpowiedzialny za obs³ugê uwierzytelniania. Udostêpnia on cztery metody, którymi u¿ytkownik mo¿e potwierdziæ swoj¹ to¿samoœæ:
\begin{enumerate}
    \item Z u¿yciem emaila i has³a.
    \item Z u¿yciem numeru telefonu.
    \item Poprzez zewnêtrznego dostawcê: \texttt{Google}, \texttt{Facebook}, \texttt{Play Games}, \texttt{Game Center}, \texttt{Apple}, \texttt{GitHub}, \texttt{Microsoft}, \texttt{Twitter}, \texttt{Yahoo}.
    \item Sesja anonimowa.
\end{enumerate}

Bazowa wersja projektu zak³ada wykorzystanie dwóch z powy¿szych metod: email i has³o oraz jeden zewnêtrzny dostawca --- \texttt{Google}. Natomiast wraz z rozwojem aplikacji przewidziane jest rozszerzenie listy zewnêtrznych dostawców oraz dodanie uwierzytelniania z wykorzystaniem numeru telefonu. Nie nale¿y to jednak do zadañ priorytetowych projektu.

Firebase dostarcza równie¿ bibliotekê \texttt{FirebaseUI}, która posiada zaimplementowany interfejs u¿ytkownika oraz wiêkszoœæ logiki programowej wymaganej do uwierzytelnienia po stronie klienta. Interfejs ten osadza siê w aplikacji i konfiguruje wed³ug w³asnych preferencji. W projekcie wykorzystano tê bibliotekê.

\subsection{Baza danych}
\texttt{Firebase} oferuje dwa rodzaje baz danych hostowanych w chmurze: \texttt{Realtime Database} i \texttt{Firestore Database}. S¹ to bazy typu \emph{real-time} (nie myliæ z nazw¹ samej bazy danych), co oznacza ¿e s¹ one w stanie wydajnie przetwarzaæ dane w czasie rzeczywistym. Z ka¿d¹ zmian¹ danych w bazie, wszystkie aktywne, pod³¹czone urz¹dzenia otrzymuj¹ natychmiastow¹ aktualizacjê. Ponadto systemy te zaprojektowane s¹ w taki sposób, ¿e gdy urz¹dzenie utraci po³¹czenie z Internetem, aplikacja mo¿e pracowaæ dalej. Jest to mo¿liwe dziêki zachowaniu lokalnej kopii ostatnio u¿ywanych danych (\emph{data persistence}). Wszystkie wykonane operacje offline s¹ synchronizowane z baz¹ po odzyskaniu po³¹czenia, a powsta³e konflikty s¹ rozstrzygane automatycznie. Obydwie bazy s¹ bazami nierelacyjnymi (NoSQL) --- \texttt{Realtime} oparty jest na obiekcie JSON, natomiast \texttt{Firestore} to baza dokumentowa. \texttt{Firestore} jest rozwi¹zaniem nowszym, bazuj¹cym poniek¹d na \texttt{Realtime}, jednak nie oznacza to, ¿e \texttt{Realtime} jest bezu¿yteczny. Oba rozwi¹zania znajduj¹ swoje zastosowania w ró¿nych przypadkach. Na potrzeby projektu, jako bazê danych wybrano \texttt{Realtime Database}, poniewa¿ jest prostsza w obs³udze wzglêdem \texttt{Firestore'a}, natomiast jej mo¿liwoœci wci¹¿ pokrywaj¹ wymagania.


Schemat struktury obiektu JSON stanowi¹cego bazê danych przedstawia pseudokod zawarty na listingu~\ref{lst:database}. Na schemacie podano typy poszczególnych pól. Znak~\texttt{?} przy nazwie pola sugeruje, ¿e pole to mo¿e przyj¹æ wartoœæ \texttt{null}. Wpis \texttt{<unique(userId)>} nale¿y rozumieæ, ¿e w obrêbie obiektu-rodzica mo¿e wyst¹piæ wiele obiektów, których nazwy s¹ unikalne. Typy \texttt{GENDERS}, \texttt{RATINGS}, \texttt{SPORTS}, \texttt{CATEGORIES} pe³ni¹ w schemacie rolê tylko pomocnicz¹, a zapis \texttt{valueOf(\emph{TYPE})} oznacza, ¿e pole przyjmuje jedn¹ wartoœæ z danego \emph{TYPE}. W przypadku \texttt{activities} i \texttt{tracks} obiekty-dzieci przyjmuj¹ nazwy odpowiadaj¹ce identyfikatorowi aktywnoœci. Wystêpuje tu relacja jeden do jednego --- jeden \emph{track} jest przyporz¹dkowany do jednej \emph{activity}.

{\belowcaptionskip=-9pt
\begin{lstlisting}[language=JavaScript, label=lst:database, caption=Pseudkod przedstawiaj¹cy strukturê zastosowanej bazy danych,
    basicstyle=\footnotesize\ttfamily]
// Pomocnicze oznaczenia
GENDERS = 'male' | 'female' | 'other';
RATINGS = 'terrible' | 'poor' | 'fair' | 'good' | 'excellent';
SPORTS = 'touring' | 'mtb' | 'enduro' | 'downhill' | 'gravel' | 'road' | 'bmx' | 'tandem' | 'cyclocross' | 'track' | 'speedway' |'other';
CATEGORIES  = 'commute' | 'casual' | 'training' | 'race' | 'bikepacking' | 'other';

// W³aœciwa struktura
db_id: {
  users: {
    <unique(userId)>?: {
      profile?: {
        gender?: valueOf(GENDERS),
        birthday?: string,
        weight?: number,
        height?: number,
        country?: string,
        city?: string,
        description?: string
      },
      activities?: {
        <unique(activityId)>: {
          creatorId: string,
          name: string,
          createdAt: number,
          lastModifiedAt: number,
          startTime: number,
          endTime: number,
          sport: valueOf(SPORTS),
          category: valueOf(CATEGORIES),
          shape: {
            isLoop: boolean,
            from: string;,
            to: string,
          },
          rating?: valueOf(RATINGS),
          tags?: string[],
          statistics?: {
            totalDistance?: number,
            totalDuration?: number,
            inMotionDuration?: number,
            maxSpeed?: number,
            elevationUp?: number,
            elevationDown?: number
          }
        }
      },
      tracks?: {
        <unique(activityId)>: {
          activityId: string,
          segments: (
            {
              lat: number,
              lon: number,
              time: number,
              ele?: number
            }[]
          )[]
        }
      }
    }
  }
};
\end{lstlisting}
}

Dostêp do zasobów bazy \texttt{Realtime} kontrolowany jest przez zasady (ang. \emph{database rules}). Ka¿de zapytanie odczytu lub zapisu do bazy przechodzi przez weryfikacjê, i jest wykonane tylko wtedy, gdy pozwol¹ na to zasady. Zasady maj¹ postaæ drzewa JSON. Przyk³ad pokazano na listingu~\ref{lst:databaserules} --- zasada udziela mo¿liwoœæ zapisywania do œcie¿ki \texttt{/users/<uid>/} tylko uwierzytelnionym u¿ytkownikom.

{\belowcaptionskip=-9pt
\begin{lstlisting}[ label=lst:databaserules, caption=Przyk³ad zasady definiuj¹cej dostêp do bazy danych,
    basicstyle=\footnotesize\ttfamily]
{
  "rules": {
    "users": {
      "$uid": {
        ".write": "$uid === auth.uid"
      }
    }
  }
}
\end{lstlisting}
}

\subsection{Hosting}
W zakresie us³ug \texttt{Firebase'a} jest równie¿ mo¿liwoœæ hostowania aplikacji. Us³uga ta jest wykorzystana w projekcie. Zbudowan¹ aplikacjê mo¿na opublikowaæ w bardzo prosty sposób z u¿yciem tylko jednej komendy. Aplikacje publikowane s¹ w dwóch domyœlnych domenach: \texttt{\emph{nazwa-aplikacji}.web.app} oraz \texttt{\emph{nazwa-aplikacji}.firebase.app}. Istnieje równie¿ mo¿liwoœæ konfiguracji w³asnej domeny.

Aplikacje hostowane s¹ w standardzie SSL, co pozwala na wykorzystanie protoko³u HTTPS. Jest to o tyle istotne, ¿e w przypadku braku protoko³u HTTPS przegl¹darki internetowe blokuj¹ dostêp do pewnych funkcjonalnoœci. W kontekœcie projektu ma to fundamentalne znaczenie, poniewa¿ jedn¹ z blokowanych funkcjonalnoœci jest lokalizacja GPS, na którym oparta jest ca³a koncepcja projektu.

\section{Warstwa frontend}
Aplikacjê klienta zaimplementowano z wykorzystaniem biblioteki \texttt{React} \cite{react} oraz jêzyka \texttt{TypeScript}. React to darmowa i otwarta biblioteka jêzyka \texttt{JavaScript}, która przeznaczona jest do budowania interfejsów u¿ytkownika aplikacji internetowych typu SPA (ang~\emph{Single-page Application}). SPA, jest to aplikacja jednostronicowa (posiada tylko jeden plik HTML), która dynamicznie aktualizuje swoj¹ zawartoœæ, zamiast dokonywaæ prze³adowania ca³ej strony. Aplikacje SPA zapewniaj¹ bardzo dobre doœwiadczenie u¿ytkownika (ang~\emph{user experience}) i wyznaczaj¹ standard tworzenia wspó³czesnych aplikacji internetowych. W zestawieniu z \texttt{Reactem} wykorzystano dodatkowe narzêdzia. Najwa¿niejsze z nich przedstawiono w tabeli~\ref{tab:biblioteki}

\begin{table}[htb] \small
    \centering
    \caption{Lista g³ównych bibliotek wykorzystanych przy tworzeniu aplikacji klienta}
    \label{tab:biblioteki}
    \begin{tabularx}{\linewidth}{|l|X|X|} \hline
        Nazwa                                     & Zastosowanie                                                                                                          & Link                                                                  \\      \hline\hline
        \texttt{TypeScript}                       & Jêzyk programowania oparty na \texttt{JavaScript}, dodaj¹cy do statyczne typowanie                                    & \url{typescriptlang.org}                                              \\      \hline
        \texttt{Less.js}                          & Rozszerzenie jêzykowe CSS, stylowanie aplikacji                                                                       & \url{lesscss.org}                                                     \\      \hline
        \texttt{React}                            & Budowa interfejsu u¿ytkownika                                                                                         & \url{reactjs.org}                                                     \\      \hline
        \texttt{Ant Design}                       & Gotowe komponenty reactowe oraz system designu                                                                        & \url{ant.design}                                                      \\      \hline
        \texttt{Firebase}                         & Integracja z platform¹ Firebase                                                                                       & \url{firebase.google.com}                                             \\      \hline
        \texttt{FirebaseUI}                       & Gotow¹ implementacja uwierzytelniania z platform¹ Firebase                                                            & \url{firebase.google.com}                                             \\      \hline
        \texttt{Leaflet}                          & Interaktywne mapy                                                                                                     & \url{leafletjs.com}                                                   \\      \hline
        \texttt{React-Leaflet}                    & Wrapper Leafleta, gotowe komponenty reactowe                                                                          & \url{react-leaflet.js.org}                                            \\      \hline
        \texttt{FileSaver.js}                     & Obs³uga zapisywania plików na dysku                                                                                   & \url{github.com/eligrey/FileSaver.js}                                 \\      \hline
        \texttt{react-vis}                        & Reactowe komponenty wykresów                                                                                          & \url{uber.github.io/react-vis/}                                       \\      \hline
        \texttt{react-icons}                      & Reactowe komponenty ikon                                                                                              & \url{react-icons.github.io/react-icons/}                              \\      \hline
        \texttt{react-resize-detector}            & API obserwacji zmiany rozmiaru elementów na stronie                                                                   & \url{github.com/maslianok/react-resize-detector}                      \\      \hline
        \texttt{react-responsive }                & API obserwacji zmiany rozmiaru okna przegl¹darki                                                                      & \url{github.com/yocontra/react-responsive}                            \\      \hline
        \texttt{GPXParser}                        & Parser standardu GPX na obiekty javascriptowe                                                                         & \url{github.com/Luuka/GPXParser.js}                                   \\      \hline
        \texttt{GPX builder}                      & Parser obiektów javascriptowych na standard GPX                                                                       & \url{github.com/Luuka/GPXParser.js}                                   \\      \hline
        \texttt{nosleep.js}                       & Mechanizm blokady wygaszania ekranu urz¹dzenia                                                                        & \url{github.com/richtr/NoSleep.js}                                    \\      \hline
        \texttt{uuid}                             & Generator unikalnych identyfikatorów                                                                                  & \url{github.com/uuidjs/uuid}                                          \\      \hline
        \texttt{he}                               & Enkoder i dekoder \emph{html entities}                                                                                & \url{github.com/mathiasbynens/he}                                     \\      \hline
        \texttt{useTimeout}, \texttt{useInterval} & Hooki reactowe umo¿liwiaj¹ce deklaratywne u¿ycie javscriptowych funkcji \texttt{setTimeout} oraz \texttt{setInterval} & \url{overreacted.io/making-setinterval-declarative-with-react-hooks/} \\      \hline
    \end{tabularx}
\end{table}